Yalnızca /home/nitro/Projeler/car-gallery-pro'da: .env
Yalnızca /home/nitro/Projeler/car-gallery-pro'da: next-env.d.ts
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/package.json /home/nitro/Projeler/car-gallery-pro/package.json
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/package.json	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/package.json	2025-10-06 15:24:05.639671749 +0300
@@ -6,7 +6,8 @@
     "dev": "next dev --turbopack",
     "build": "next build",
     "start": "next start",
-    "lint": "next lint"
+    "lint": "next lint",
+    "seed": "npx prisma db seed"
   },
   "dependencies": {
     "@ai-sdk/openai": "^1.1.13",
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/app/_actions/car.ts /home/nitro/Projeler/car-gallery-pro/src/app/_actions/car.ts
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/app/_actions/car.ts	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/app/_actions/car.ts	2025-10-06 15:34:13.334004750 +0300
@@ -1,5 +1,6 @@
 "use server";
 import { auth } from "@/auth";
+import sanitizeHtml from 'sanitize-html';
 import { StreamableSkeletonProps } from "@/components/admin/cars/StreamableSkeletion";
 import { routes } from "@/config/routes";
 import { prisma } from "@/lib/prisma";
@@ -10,106 +11,97 @@
 import { forbidden, redirect } from "next/navigation";
 import slugify from "slugify";
 import { createPngDataUri } from "unlazy/thumbhash";
-import { UpdateCarType } from "../schemas/car.schema";
-export const createCarAction = async (data: StreamableSkeletonProps) => {
+import { CreateCarType, UpdateCarType } from "../schemas/car.schema";
+
+
+export const createCarAction = async (data: CreateCarType) => {
   const session = await auth();
-  if (!session)
-    return {
-      success: false,
-      message: "Unauthorized",
-    };
+  if (!session) {
+    forbidden();
+  }
 
   let success = false;
-  let carId: number | null = null;
   try {
+    const makeId = Number(data.make);
+    const modelId = Number(data.model);
+    const modelVariantId = data.modelVariant ? Number(data.modelVariant) : null;
+
     const make = await prisma.make.findUnique({
-      where: {
-        id: data.makeId as number,
-      },
+      where: { id: makeId as number },
     });
+
     const model = await prisma.model.findUnique({
-      where: {
-        id: data.modelId as number,
-      },
+      where: { id: modelId as number },
     });
+
     let title = `${data.year} ${make?.name} ${model?.name}`;
-    if (data.modelVariantId) {
+
+    if (modelVariantId) {
       const modelVariant = await prisma.modelVariant.findUnique({
-        where: {
-          id: data.modelVariantId as number,
-        },
+        where: { id: modelVariantId },
       });
-      if (modelVariant) {
-        title += ` ${modelVariant.name}`;
-      }
-    }
 
-    let slug = slugify(`${title} ${data.vrm ?? randomInt(100000, 999999)}`);
-
-    // check if slug already exists
-    const slugLikeFound = await prisma.classified.count({
-      where: {
-        slug: {
-          contains: slug,
-          mode: "insensitive",
-        },
-      },
-    });
-    if (slugLikeFound) {
-      slug = slugify(`${title} ${data.vrm} ${slugLikeFound + 1}`);
+      if (modelVariant) title = `${title} ${modelVariant.name}`;
     }
 
-    const thumbHash = await generateThumbHashFromSrUrl(data.image as string);
-    const uri = createPngDataUri(thumbHash);
+    const slug = slugify(`${title} ${data.vrm}`);
+    
+    const cleanDescription = sanitizeHtml(data.description, {
+      allowedTags: [ 'p', 'a', 'strong', 'b', 'em', 'i', 'u', 'strike', 'br', 'ul', 'ol', 'li' ],
+      allowedAttributes: { 'a': [ 'href', 'rel', 'target' ] }
+    });
 
     const createdCar = await prisma.classified.create({
       data: {
         slug,
         title,
         year: Number(data.year),
-        makeId: data.makeId as number,
-        modelId: data.modelId as number,
-        ...(data.modelVariantId && {
-          modelVariantId: data.modelVariantId as number,
-        }),
-        vrm: data?.vrm ? data.vrm : null,
-        price: 0,
-        currency: CurrencyCode.EUR,
+        makeId,
+        modelId,
+        ...(modelVariantId && { modelVariantId }),
+        vrm: data.vrm,
+        price: data.price * 100,
+        currency: data.currency,
         odoReading: data.odoReading,
         odoUnit: data.odoUnit,
         fuelType: data.fuelType,
         bodyType: data.bodyType,
-        colour: data.colour,
         transmission: data.transmission,
+        colour: data.colour,
         ulezCompliance: data.ulezCompliance,
-        description: data.description,
+        description: cleanDescription,
         doors: data.doors,
         seats: data.seats,
+        status: data.status,
         images: {
-          create: {
-            isMain: true,
-            blurhash: uri,
-            src: data.image as string,
-            alt: title,
-          },
+          create: await Promise.all(
+            data.images.map(async ({ src }, index) => {
+              const hash = await generateThumbHashFromSrUrl(src);
+              const uri = createPngDataUri(hash);
+              return {
+                isMain: !index,
+                blurhash: uri,
+                src,
+                alt: `${title} ${index + 1}`,
+              };
+            })
+          ),
         },
       },
     });
 
-    if (createdCar) {
-      carId = createdCar.id;
-      success = true;
+    if (createdCar) success = true;
+
+  } catch (err) {
+    console.log({ err });
+    if (err instanceof Error) {
+      return { success: false, message: err.message };
     }
-  } catch (error) {
-    return {
-      success: false,
-      message: "Failed to create car",
-    };
+    return { success: false, message: "Something went wrong" };
   }
-
-  if (success && carId) {
+  if (success) {
     revalidatePath(routes.admin.cars);
-    redirect(routes.admin.editCar(carId));
+    redirect(routes.admin.cars);
   } else {
     return { success: false, message: "Failed to create classified" };
   }
@@ -173,6 +165,11 @@
           data: imagesData,
         });
 
+        const cleanDescription = sanitizeHtml(data.description, {
+          allowedTags: [ 'p', 'a', 'strong', 'b', 'em', 'i', 'u', 'strike', 'br', 'ul', 'ol', 'li' ],
+          allowedAttributes: { 'a': [ 'href', 'rel', 'target' ] }
+        });
+
         const updatedCar = await prisma.classified.update({
           where: { id: data.id },
           data: {
@@ -192,7 +189,7 @@
             transmission: data.transmission,
             colour: data.colour,
             ulezCompliance: data.ulezCompliance,
-            description: data.description,
+            description: cleanDescription,
             doors: data.doors,
             seats: data.seats,
             status: data.status,
Yalnızca /home/nitro/Projeler/car-gallery-pro/src/app/admin/cars'da: new
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/app/schemas/car.schema.ts /home/nitro/Projeler/car-gallery-pro/src/app/schemas/car.schema.ts
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/app/schemas/car.schema.ts	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/app/schemas/car.schema.ts	2025-10-06 15:33:36.463796578 +0300
@@ -65,4 +65,7 @@
 	),
 });
 
-export type UpdateCarType = z.infer<typeof updateCarSchema>;
\ Dosya sonunda yenisatır yok
+export type UpdateCarType = z.infer<typeof updateCarSchema>;
+
+export const createCarSchema = updateCarSchema.omit({ id: true });
+export type CreateCarType = z.infer<typeof createCarSchema>;
\ Dosya sonunda yenisatır yok
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/admin/cars/cars-header.tsx /home/nitro/Projeler/car-gallery-pro/src/components/admin/cars/cars-header.tsx
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/admin/cars/cars-header.tsx	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/components/admin/cars/cars-header.tsx	2025-10-06 15:52:53.213816726 +0300
@@ -1,12 +1,13 @@
-import RadioFilter from '@/components/shared/radio-filter'
-import { AwaitedPageProps } from '@/config/types'
-import { ClassifiedStatus } from '@prisma/client'
-import React from 'react'
-import CreateCarDialog from './CreateCarDialog'
+import { Button } from '@/components/ui/button';
+import { routes } from '@/config/routes';
+import Link from 'next/link';
+import RadioFilter from '@/components/shared/radio-filter';
+import { AwaitedPageProps } from '@/config/types';
+import { ClassifiedStatus } from '@prisma/client';
 
 const CarManageHeader = ({searchParams}: AwaitedPageProps) => {
   return (
-    <div className='flex flex-col p-6 space-y-4 text-muted'>
+    <div className='flex flex-col p-6 space-y-4'>
       <div className="flex items-center justify-between">
         <h1 className='font-bold text-lg md:text-2xl'>
             All cars/vehicles
@@ -16,8 +17,9 @@
                 searchParams={searchParams}
                 items={["ALL", ...Object.values(ClassifiedStatus)]}
             />
-            {/* create cars dialog */}
-            <CreateCarDialog />
+            <Button asChild className="ml-4" size={"sm"}>
+              <Link href={routes.admin.newCar}>Add new</Link>
+            </Button>
         </div>
       </div>
     </div>
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/admin/cars/CreateCarDialog.tsx /home/nitro/Projeler/car-gallery-pro/src/components/admin/cars/CreateCarDialog.tsx
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/admin/cars/CreateCarDialog.tsx	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/components/admin/cars/CreateCarDialog.tsx	2025-10-06 15:46:24.622201036 +0300
@@ -1,5 +1,6 @@
 "use client";
 import { Button } from "@/components/ui/button";
+import { FuelType, BodyType, Transmission, Colour, ULEZCompliance, OdoUnit, ClassifiedStatus, CurrencyCode } from "@prisma/client";
 import {
   Dialog,
   DialogContent,
@@ -8,81 +9,73 @@
   DialogTrigger,
 } from "@/components/ui/dialog";
 import { cn } from "@/lib/utils";
-import { readStreamableValue, useActions, useUIState } from "ai/rsc";
-import { AI } from "@/app/_actions/ai";
-
 import React, { useState, useTransition } from "react";
 import { SubmitHandler, useForm } from "react-hook-form";
 import { zodResolver } from "@hookform/resolvers/zod";
-import {
-  SingleImageSchema,
-  SingleImageType,
-} from "@/app/schemas/images.schema";
-import { StreamableSkeletonProps } from "./StreamableSkeletion";
-import { CarAISchema } from "@/app/schemas/car-ai";
-import { z } from "zod";
 import { createCarAction } from "@/app/_actions/car";
 import { toast } from "sonner";
 import { Form } from "@/components/ui/form";
 import { Loader2 } from "lucide-react";
-import SingleImageUploader from "./SingleImageUploader";
+import CarFormField from "../../car/car-form-fields";
+import { CreateCarType, createCarSchema } from "@/app/schemas/car.schema";
+import MultiImageUploader from "../../car/mutil-image-uploader";
+import {
+  FormControl,
+  FormField,
+  FormItem,
+  FormLabel,
+  FormMessage,
+} from "@/components/ui/form";
+
 
 const CreateCarDialog = () => {
   const [isModalOpen, setIsModalOpen] = useState(false);
-  const [isUploading, startUploadTransition] = useTransition();
   const [isCreating, startCreateTransition] = useTransition();
 
-  const { generateCar } = useActions<typeof AI>();
-  const [messages, setMessages] = useUIState<typeof AI>();
-
-  const imageForm = useForm<SingleImageType>({
-    resolver: zodResolver(SingleImageSchema),
+  const form = useForm<CreateCarType>({
+    resolver: zodResolver(createCarSchema),
+    defaultValues: {
+      images: [],
+      year: "",
+      make: "",
+      model: "",
+      modelVariant: "",
+      description: "",
+      vrm: "",
+      odoReading: undefined,
+      price: undefined,
+      doors: undefined,
+      seats: undefined,
+      fuelType: FuelType.PETROL,
+      bodyType: BodyType.SEDAN,
+      transmission: Transmission.AUTOMATIC,
+      colour: Colour.BLACK,
+      ulezCompliance: ULEZCompliance.EXEMPT,
+      odoUnit: OdoUnit.MILES,
+      status: ClassifiedStatus.FOR_SALE,
+      currency: CurrencyCode.EUR,
+    },
   });
 
-  const createForm = useForm<StreamableSkeletonProps>({
-    resolver: zodResolver(
-      CarAISchema.extend({
-        make: z.object({
-          id: z.number().int(),
-          name: z.string(),
-          image: z.string(),
-          createdAt: z.date(),
-          updatedAt: z.date(),
-        }),
-      })
-    ),
-  });
-
-  const handleImageUpload = async (url: string) => {
-    imageForm.setValue("image", url);
-  };
-
-  const onImageSubmit: SubmitHandler<SingleImageType> = async (data) => {
-    startUploadTransition(async () => {
-      const responseMessage = await generateCar(data.image);
-      if (!responseMessage) return;
-      setMessages((prev) => [...prev, responseMessage]);
-      for await (const value of readStreamableValue(responseMessage.car)) {
-        if (value) {
-          createForm.reset(value);
-        }
-      }
-    });
-  };
-
-  const onCreateSubmit: SubmitHandler<StreamableSkeletonProps> = (data) => {
+  const onCreateSubmit: SubmitHandler<CreateCarType> = (data) => {
     startCreateTransition(async () => {
-      setMessages([]);
-      const { success, message } = await createCarAction(data);
-
-      if (!success) {
+      const result = await createCarAction(data);
+      if (result?.success) {
+        toast.success("Success", {
+          description: "Car created successfully",
+          duration: 3000,
+        });
+        setIsModalOpen(false);
+        form.reset();
+      } else {
         toast.error("Error", {
-          description: message || "Something went wrong",
+          description: result?.message || "Something went wrong",
           duration: 3000,
         });
       }
     });
   };
+
   return (
     <Dialog open={isModalOpen} onOpenChange={setIsModalOpen}>
       <DialogTrigger asChild>
@@ -90,72 +83,53 @@
           Add new
         </Button>
       </DialogTrigger>
-      <DialogContent className={cn(` bg-white max-w-7xl`)}>
-        <DialogHeader>
+      <DialogContent className={cn(`bg-card max-w-6xl`)}>        <DialogHeader>
           <DialogTitle>Create new car</DialogTitle>
         </DialogHeader>
-        {messages.length ? (
-          <Form {...createForm}>
-            <form
-              className="space-y-4"
-              onSubmit={createForm.handleSubmit(onCreateSubmit)}
-            >
-              {messages.map((message) => (
-                <div className="w-full" key={message.id}>
-                  {message.display}
-                </div>
-              ))}
-              <div className="flex justify-between gap-2">
-                <Button
-                  variant="outline"
-                  type="button"
-                  onClick={() => setIsModalOpen(false)}
-                >
-                  Cancel
-                </Button>
-                <Button
-                  disabled={isCreating || isUploading}
-                  type="submit"
-                  className="flex items-center gap-x-2"
-                >
-                  {isCreating || isUploading ? (
-                    <Loader2 className="animate-spin h-4 w-4" />
-                  ) : null}
-                  {isUploading ? "Uploading..." : "Create"}
-                </Button>
-              </div>
-            </form>
-          </Form>
-        ) : (
-          <Form {...imageForm}>
-            <form
-              onSubmit={imageForm.handleSubmit(onImageSubmit)}
-              className="space-y-4"
-            >
-              <SingleImageUploader onUploadComplete={handleImageUpload} />
-              <div className="flex justify-between gap-2">
-                <Button
-                  variant={"outline"}
-                  type="button"
-                  onClick={() => setIsModalOpen(false)}
-                >
-                  Cancel
-                </Button>
-                <Button
-                  disabled={isUploading}
-                  type="submit"
-                  className="flex items-center gap-x-2"
-                >
-                  {isUploading ? (
-                    <Loader2 className="animate-spin h-4 w-4" />
-                  ) : (
-                    "Upload Image"
+        <Form {...form}>
+          <form
+            className="space-y-4"
+            onSubmit={form.handleSubmit(onCreateSubmit)}
+          >
+            <div className="w-full mx-auto grid grid-cols-1 lg:grid-cols-2 gap-6">
+              <CarFormField />
+               <div className="space-y-6">
+                <FormField
+                  control={form.control}
+                  name="images"
+                  render={({ field: { name, onChange } }) => (
+                    <FormItem>
+                      <FormLabel className="text-muted" htmlFor="images">
+                        Images (up to 8)
+                      </FormLabel>
+                      <FormControl>
+                        <MultiImageUploader name={name} onChange={onChange} />
+                      </FormControl>
+                      <FormMessage />
+                    </FormItem>
                   )}
-                </Button>
+                />
               </div>
-            </form>
-          </Form>
-        )}
+            </div>
+            <div className="flex justify-end gap-2">
+              <Button
+                variant="outline"
+                type="button"
+                onClick={() => setIsModalOpen(false)}
+              >
+                Cancel
+              </Button>
+              <Button
+                disabled={isCreating}
+                type="submit"
+                className="flex items-center gap-x-2"
+              >
+                {isCreating && <Loader2 className="animate-spin h-4 w-4" />}
+                Create Car
+              </Button>
+            </div>
+          </form>
+        </Form>
       </DialogContent>
     </Dialog>
   );
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/car/car-form-fields.tsx /home/nitro/Projeler/car-gallery-pro/src/components/car/car-form-fields.tsx
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/car/car-form-fields.tsx	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/components/car/car-form-fields.tsx	2025-10-06 15:56:27.474284983 +0300
@@ -51,7 +51,7 @@
 const CarFormField = () => {
   const form = useFormContext();
   return (
-    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-muted">
+    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-foreground">
       <FormField
         control={form.control}
         name="year"
@@ -60,11 +60,11 @@
             <FormLabel htmlFor="year">Year</FormLabel>
             <FormControl>
               <Select
-                selectClassName="text-gray-500 bg-gray-800 border-transparent"
                 options={years.map((year) => ({
                   label: year,
                   value: year,
                 }))}
+                className="text-white"
                 {...rest}
               />
             </FormControl>
@@ -105,11 +105,11 @@
             <FormLabel htmlFor="transmission">Transmission</FormLabel>
             <FormControl>
               <Select
-                selectClassName="text-gray-500 bg-primary-800 border-transparent"
                 options={Object.values(Transmission).map((value) => ({
                   label: formatTransmission(value),
                   value,
                 }))}
+                className="text-white"
                 {...rest}
               />
             </FormControl>
@@ -125,11 +125,11 @@
             <FormLabel htmlFor="fuelType">Fuel Type</FormLabel>
             <FormControl>
               <Select
-                selectClassName="text-gray-500 bg-primary-800 border-transparent"
                 options={Object.values(FuelType).map((value) => ({
                   label: formatFuelType(value),
                   value,
                 }))}
+                className="text-white"
                 {...rest}
               />
             </FormControl>
@@ -145,11 +145,11 @@
             <FormLabel htmlFor="bodyType">Body Type</FormLabel>
             <FormControl>
               <Select
-                selectClassName="text-gray-500 bg-primary-800 border-transparent"
                 options={Object.values(BodyType).map((value) => ({
                   label: formatBodyType(value),
                   value,
                 }))}
+                className="text-white"
                 {...rest}
               />
             </FormControl>
@@ -165,11 +165,11 @@
             <FormLabel htmlFor="colour">Colour</FormLabel>
             <FormControl>
               <Select
-                selectClassName="text-gray-500 bg-primary-800 border-transparent"
                 options={Object.values(Colour).map((value) => ({
                   label: formatColour(value),
                   value,
                 }))}
+                className="text-white"
                 {...rest}
               />
             </FormControl>
@@ -185,11 +185,11 @@
             <FormLabel htmlFor="ulezCompliance">ULEZ Compliance</FormLabel>
             <FormControl>
               <Select
-                selectClassName="text-gray-500 bg-primary-800 border-transparent"
                 options={Object.values(ULEZCompliance).map((value) => ({
                   label: value,
                   value,
                 }))}
+                className="text-white"
                 {...rest}
               />
             </FormControl>
@@ -207,7 +207,7 @@
             <FormControl>
               <Input
                 placeholder="LA16 PYW"
-                className="uppercase text-muted h-10 mt-1 bg-primary-800 placeholder:text-gray-500"
+                className="uppercase text-white"
                 {...rest}
               />
             </FormControl>
@@ -226,8 +226,7 @@
                 max={6}
                 min={1}
                 placeholder="0"
-                style={{ background: "#081a2b" }}
-                className="text-muted placeholder:text-gray-500"
+                className="text-white"
                 onValueChange={(values) => {
                   onChange(values.floatValue);
                 }}
@@ -249,8 +248,7 @@
                 max={8}
                 min={1}
                 placeholder="0"
-                style={{ background: "#081a2b" }}
-                className="text-muted placeholder:text-gray-500"
+                className="text-white"
                 onValueChange={(values) => {
                   onChange(values.floatValue);
                 }}
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/car/car-form.tsx /home/nitro/Projeler/car-gallery-pro/src/components/car/car-form.tsx
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/car/car-form.tsx	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/components/car/car-form.tsx	2025-10-06 15:50:08.831636108 +0300
@@ -1,12 +1,26 @@
 "use client";
-import { updateCarSchema, UpdateCarType } from "@/app/schemas/car.schema";
+import {
+  createCarSchema,
+  CreateCarType,
+  updateCarSchema,
+  UpdateCarType,
+} from "@/app/schemas/car.schema";
 import { CarWithImages } from "@/config/types";
 import { zodResolver } from "@hookform/resolvers/zod";
-import { ClassifiedStatus, CurrencyCode, Prisma } from "@prisma/client";
+import {
+  BodyType,
+  ClassifiedStatus,
+  Colour,
+  CurrencyCode,
+  FuelType,
+  OdoUnit,
+  Transmission,
+  ULEZCompliance,
+} from "@prisma/client";
 import React, { useTransition } from "react";
 import { SubmitHandler, useForm } from "react-hook-form";
 import { Form } from "../ui/form";
-import { updateCarAction } from "@/app/_actions/car";
+import { createCarAction, updateCarAction } from "@/app/_actions/car";
 import { toast } from "sonner";
 import CarFormField from "./car-form-fields";
 import {
@@ -21,73 +35,83 @@
 import { Loader2 } from "lucide-react";
 import { formatCarStatus } from "@/lib/utils";
 import MultiImageUploader from "./mutil-image-uploader";
+
 interface CarFormProps {
-  car: CarWithImages;
+  car?: CarWithImages;
 }
 
-function extractKey(url: string) {
-  const nextUrl = new URL(url);
-  nextUrl.href = url;
-  const regex = /upload\/.+/;
-  const match = url.match(regex);
-
-  return match ? match[0] : url;
-}
 const CarForm = ({ car }: CarFormProps) => {
   const [isPending, startTransition] = useTransition();
+  const isEditMode = !!car;
 
-  const form = useForm<UpdateCarType>({
-    resolver: zodResolver(updateCarSchema),
-    defaultValues: {
-      id: car.id,
-      odoUnit: car.odoUnit,
-      currency: CurrencyCode.EUR,
-      ...(car && {
-        images: car.images
-          ? car.images.map((image, index) => ({
-              ...image,
-              id: index + 1, // Assuming images are indexed starting from 1
-              percentage: 100, // Default percentage for each image
-              key: extractKey(image.src), // Extract key from the image URL
-              done: true,
-            }))
-          : [],
-        make: car.makeId.toString(),
-        model: car.modelId.toString(),
-        modelVariant: car.modelVariantId?.toString(),
-        year: car.year.toString(),
-        vrm: car.vrm ?? "",
-        description: car.description ?? "",
-        fuelType: car.fuelType,
-        bodyType: car.bodyType,
-        transmission: car.transmission,
-        colour: car.colour,
-        ulezCompliance: car.ulezCompliance,
-        status: car.status,
-        odoReading: car.odoReading,
-        seats: car.seats,
-        doors: car.doors,
-        price: car.price / 100,
-      }),
-    },
+  const form = useForm<CreateCarType | UpdateCarType>({
+    resolver: zodResolver(isEditMode ? updateCarSchema : createCarSchema),
+    defaultValues: isEditMode
+      ? {
+          id: car.id,
+          odoUnit: car.odoUnit,
+          currency: car.currency,
+          images: car.images || [],
+          make: car.makeId.toString(),
+          model: car.modelId.toString(),
+          modelVariant: car.modelVariantId?.toString(),
+          year: car.year.toString(),
+          vrm: car.vrm ?? "",
+          description: car.description ?? "",
+          fuelType: car.fuelType,
+          bodyType: car.bodyType,
+          transmission: car.transmission,
+          colour: car.colour,
+          ulezCompliance: car.ulezCompliance,
+          status: car.status,
+          odoReading: car.odoReading,
+          seats: car.seats,
+          doors: car.doors,
+          price: car.price / 100,
+        }
+      : {
+          images: [],
+          year: "",
+          make: "",
+          model: "",
+          modelVariant: "",
+          description: "",
+          vrm: "",
+          odoReading: undefined,
+          price: undefined,
+          doors: undefined,
+          seats: undefined,
+          fuelType: FuelType.PETROL,
+          bodyType: BodyType.SEDAN,
+          transmission: Transmission.AUTOMATIC,
+          colour: Colour.BLACK,
+          ulezCompliance: ULEZCompliance.EXEMPT,
+          odoUnit: OdoUnit.MILES,
+          status: ClassifiedStatus.FOR_SALE,
+          currency: CurrencyCode.EUR,
+        },
   });
 
-  const carformSubmit: SubmitHandler<UpdateCarType> = async (data) => {
+  const carformSubmit: SubmitHandler<CreateCarType | UpdateCarType> = async (
+    data
+  ) => {
     startTransition(async () => {
-      const { success, message } = await updateCarAction(data);
-      if (!success) {
-        toast.error("Error updating this car", {
-          description: message,
-          duration: 2500,
-        });
+      const action = isEditMode ? updateCarAction : createCarAction;
+      // @ts-ignore
+      const result = await action(data);
+      if (result?.success) {
+        toast.success(isEditMode ? "Car updated" : "Car created");
+      } else {
+        toast.error(`Error: ${result?.message}`);
       }
     });
   };
+
   return (
     <Form {...form}>
       <form action="" onSubmit={form.handleSubmit(carformSubmit)}>
-        <h1 className="text-3xl font-bold mb-6 text-muted">
-          Upload vehicles details
+        <h1 className="text-3xl font-bold mb-6">
+          {isEditMode ? "Edit Vehicle Details" : "Create New Vehicle"}
         </h1>
         <div className="w-full mx-auto grid grid-cols-1 lg:grid-cols-2 gap-6">
           <CarFormField />
@@ -97,11 +121,9 @@
               name="images"
               render={({ field: { name, onChange } }) => (
                 <FormItem>
-                  <FormLabel className="text-muted" htmlFor="images">
-                    Images (up to 8)
-                  </FormLabel>
+                  <FormLabel htmlFor="images">Images (up to 8)</FormLabel>
                   <FormControl>
-                     <MultiImageUploader name={name} onChange={onChange} /> 
+                    <MultiImageUploader name={name} onChange={onChange} />
                   </FormControl>
                   <FormMessage />
                 </FormItem>
@@ -113,9 +135,7 @@
               name="status"
               render={({ field: { ref, ...rest } }) => (
                 <FormItem>
-                  <FormLabel className="text-muted" htmlFor="status">
-                    Status
-                  </FormLabel>
+                  <FormLabel htmlFor="status">Status</FormLabel>
                   <FormControl>
                     <Select
                       options={Object.values(ClassifiedStatus).map((value) => ({
@@ -123,7 +143,6 @@
                         value,
                       }))}
                       noDefault={false}
-                      selectClassName="bg-primary-800 border-transparent text-muted/75"
                       {...rest}
                     />
                   </FormControl>
@@ -135,10 +154,10 @@
             <Button
               disabled={isPending}
               type="submit"
-              className="w-full flex gap-x-2 bg-yellow-400"
+              className="w-full flex gap-x-2"
             >
               {isPending && <Loader2 className="animate-spin h-4 w-4" />}
-              Submit
+              {isEditMode ? "Update Car" : "Create Car"}
             </Button>
           </div>
         </div>
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/car/car-view.tsx /home/nitro/Projeler/car-gallery-pro/src/components/car/car-view.tsx
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/car/car-view.tsx	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/components/car/car-view.tsx	2025-10-06 15:52:18.277570389 +0300
@@ -139,10 +139,7 @@
             </Button>
             <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
               {features(props).map(({ id, icon, label }) => (
-							<div
-								key={id}
-								className="bg-gray-100 rounded-lg shadow-xs p-4 text-center flex items-center flex-col"
-							>
+                <div className="bg-muted rounded-lg shadow-xs p-4 text-center flex items-center flex-col">
 								{icon}
 								<p className="text-sm font-medium mt-2">{label}</p>
 							</div>
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/car/TaxonomySelect.tsx /home/nitro/Projeler/car-gallery-pro/src/components/car/TaxonomySelect.tsx
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/car/TaxonomySelect.tsx	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/components/car/TaxonomySelect.tsx	2025-10-06 15:55:16.091803026 +0300
@@ -77,49 +77,45 @@
 					<FormItem>
 						<FormLabel htmlFor="make">Make</FormLabel>
 						<FormControl>
-							<Select
-								selectClassName="text-gray-500 bg-gray-800 border-transparent"
-								options={makes}
-								onChange={(e) => handleChange(e, onChange)}
-								{...rest}
-							/>
-						</FormControl>
-						<FormMessage />
-					</FormItem>
-				)}
-			/>
-			<FormField
-				control={form.control}
-				name="model"
-				render={({ field: { onChange, ref, ...rest } }) => (
-					<FormItem>
-						<FormLabel htmlFor="model">Model</FormLabel>
-						<FormControl>
-							<Select
-								selectClassName="text-gray-500 bg-gray-800 border-transparent"
-								options={models}
-								onChange={(e) => handleChange(e, onChange)}
-								{...rest}
-							/>
-						</FormControl>
-						<FormMessage />
-					</FormItem>
-				)}
-			/>
-			<FormField
-				control={form.control}
-				name="modelVariant"
-				render={({ field: { onChange, ref, ...rest } }) => (
-					<FormItem>
-						<FormLabel htmlFor="modelVariant">Model Variant</FormLabel>
-						<FormControl>
-							<Select
-								selectClassName="text-gray-500 bg-gray-800 border-transparent"
-								options={modelvariant}
-								onChange={(e) => handleChange(e, onChange)}
-								{...rest}
-							/>
-						</FormControl>
+							              <Select
+							                options={makes}
+							                onChange={(e) => handleChange(e, onChange)}
+							                {...rest}
+							              />
+							            </FormControl>
+							            <FormMessage />
+							          </FormItem>
+							        )}
+							      />
+							      <FormField
+							        control={form.control}
+							        name="model"
+							        render={({ field: { onChange, ref, ...rest } }) => (
+							          <FormItem>
+							            <FormLabel htmlFor="model">Model</FormLabel>
+							            <FormControl>
+							              <Select
+							                options={models}
+							                onChange={(e) => handleChange(e, onChange)}
+							                {...rest}
+							              />
+							            </FormControl>
+							            <FormMessage />
+							          </FormItem>
+							        )}
+							      />
+							      <FormField
+							        control={form.control}
+							        name="modelVariant"
+							        render={({ field: { onChange, ref, ...rest } }) => (
+							          <FormItem>
+							            <FormLabel htmlFor="modelVariant">Model Variant</FormLabel>
+							            <FormControl>
+							              <Select
+							                options={modelvariant}
+							                onChange={(e) => handleChange(e, onChange)}
+							                {...rest}
+							              />						</FormControl>
 						<FormMessage />
 					</FormItem>
 				)}
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/ui/input-select.tsx /home/nitro/Projeler/car-gallery-pro/src/components/ui/input-select.tsx
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/ui/input-select.tsx	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/components/ui/input-select.tsx	2025-10-06 15:57:51.835846929 +0300
@@ -24,54 +24,54 @@
 		props;
 
 	const form = useFormContext();
-    return (
-    <div className="w-full relative">
-      <FormField
-				control={form.control}
-				name={inputName}
-				render={({ field: { onChange, ...rest } }) => (
-					<FormItem>
-						{label && <FormLabel htmlFor={inputName}>{label}</FormLabel>}
-						<FormControl>
-							<NumberInput
-								onValueChange={(values) => {
-									onChange(values.floatValue);
-								}}
-								{...rest}
-								{...numberInputProps}
-							/>
-						</FormControl>
-						<FormMessage />
-					</FormItem>
-				)}
-			/>
-			<FormField
-				control={form.control}
-				name={selectName}
-				render={({ field: { ref, ...rest } }) => (
-					<FormItem>
-						<FormControl>
-							<div className="absolute right-0 -translate-y-10 h-10 flex items-center pr-2 border-l border-l-border">
-								<select
-									className={cn(
-										"custom-select appearance-none pr-10 bg-no-repeat disabled:bg-muted/50 border rounded-md focus:outline-hidden focus:ring-0 focus-visible:ring-0 pl-3 text-muted-foreground border-transparent",
-									)}
-									{...rest}
-								>
-									{options.map((option) => (
-										<option key={option.value} value={option.label}>
-											{option.label}
-										</option>
-									))}
-								</select>
-							</div>
-						</FormControl>
-						<FormMessage />
-					</FormItem>
-				)}
-			/>
-    </div>
-  )
+  return (
+    <FormField
+      control={form.control}
+      name={inputName}
+      render={({ field: { onChange, ...rest } }) => (
+        <FormItem className="grid gap-2">
+          {label && <FormLabel htmlFor={inputName}>{label}</FormLabel>}
+          <FormControl>
+            <div className="flex items-center rounded-md border border-input focus-within:border-ring focus-within:ring-ring/50 focus-within:ring-[3px] h-10 py-2">
+              <NumberInput
+                className="flex-grow border-none focus:outline-none focus:ring-0 text-white min-w-0"
+                onValueChange={(values) => {
+                  onChange(values.floatValue);
+                }}
+                {...rest}
+                {...numberInputProps}
+              />
+              <div className="border-l border-l-input h-full">
+                <FormField
+                  control={form.control}
+                  name={selectName}
+                  render={({ field }) => (
+                    <FormItem>
+                      <FormControl>
+                        <select
+                          className={cn(
+                            "custom-select appearance-none bg-transparent pl-3 pr-8 text-white focus:outline-none"
+                          )}
+                          {...field}
+                        >
+                          {options.map((option) => (
+                            <option key={option.value} value={option.value}>
+                              {option.label}
+                            </option>
+                          ))}
+                        </select>
+                      </FormControl>
+                    </FormItem>
+                  )}
+                />
+              </div>
+            </div>
+          </FormControl>
+          <FormMessage />
+        </FormItem>
+      )}
+    />
+  );
 }
 
 export default InputSelect
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/ui/number-input.tsx /home/nitro/Projeler/car-gallery-pro/src/components/ui/number-input.tsx
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/ui/number-input.tsx	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/components/ui/number-input.tsx	2025-10-06 15:54:34.485519015 +0300
@@ -15,7 +15,7 @@
 			allowNegative={false}
 			className={cn(
 				className,
-				"mt-1 flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-5 text-sm",
+				"mt-1 flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-5 text-sm text-white",
 			)}
 			{...props}
 		/>
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/ui/select.tsx /home/nitro/Projeler/car-gallery-pro/src/components/ui/select.tsx
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/components/ui/select.tsx	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/components/ui/select.tsx	2025-10-06 16:00:01.522697407 +0300
@@ -13,7 +13,6 @@
 
 export const Select = (props: SelectProps) => {
 	const {
-		label,
 		value,
 		options,
 		onChange,
@@ -24,26 +23,21 @@
 	} = props;
 
 	return (
-		<div className={cn("mt-1", className)}>
-			{label && <h4 className="text-sm font-semibold">{label}</h4>}
-			<div className="mt-1">
-				<select
-					onChange={onChange}
-					value={value ?? ""}
-					className={cn(
-						selectClassName,
-						"bg-transparent disabled:bg-muted/50 w-full px-3 py-2 border-input border rounded-md focus:outline-hidden custom-select appearance-none pr-12 bg-transparent",
-					)}
-					{...rest}
-				>
-					{noDefault && <option value="">Select</option>}
-					{options.map((option) => (
-						<option key={option.value} value={option.value}>
-							{option.label}
-						</option>
-					))}
-				</select>
-			</div>
-		</div>
+		<select
+			onChange={onChange}
+			value={value ?? ""}
+			className={cn(
+				className,
+				"bg-transparent disabled:bg-muted/50 w-full px-3 py-2 border-input border rounded-md focus:outline-hidden custom-select appearance-none pr-12 bg-transparent text-white",
+			)}
+			{...rest}
+		>
+			{noDefault && <option value="">Select</option>}
+			{options.map((option) => (
+				<option key={option.value} value={option.value}>
+					{option.label}
+				</option>
+			))}
+		</select>
 	);
 };
\ Dosya sonunda yenisatır yok
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/config/routes.ts /home/nitro/Projeler/car-gallery-pro/src/config/routes.ts
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/config/routes.ts	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/config/routes.ts	2025-10-06 15:50:46.455911470 +0300
@@ -16,6 +16,7 @@
     admin:{
         dashboard: "/admin/dashboard",
         cars: "/admin/cars",
+        newCar: "/admin/cars/new",
         customers: "/admin/customers",
         settings: "/admin/settings",
         editCar: (id:number ) => `/admin/cars/edit/${id}`,
diff -r -u '--exclude=.git' '--exclude=.next' '--exclude=node_modules' '--exclude=.old' '--exclude=rapor.txt' '--exclude=project_diff.txt' '--exclude=latest_changes_diff.txt' /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/lib/ai-utils.ts /home/nitro/Projeler/car-gallery-pro/src/lib/ai-utils.ts
--- /home/nitro/Projeler/car-gallery-pro/.old/memati-original/CAR-GALLERY-PRO-main/src/lib/ai-utils.ts	2025-10-06 11:50:07.000000000 +0300
+++ /home/nitro/Projeler/car-gallery-pro/src/lib/ai-utils.ts	2025-10-06 15:28:13.602000920 +0300
@@ -12,6 +12,9 @@
     object: MapToTaxonomyOrCreateType
 ) {
     // find the make in db i.e Audi
+    if (object.make === 'Unknown') {
+        return null;
+    }
     const make = await prisma.make.findFirst({
         where: {
             name: {equals: object.make,
